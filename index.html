<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pengantaran Andaria</title>

  <!-- Bootstrap & Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <!-- Firebase & ScrollReveal -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <script src="https://unpkg.com/scrollreveal"></script>

  <style>
    :root{
      --text:#f0f0f0;--border:#444;
      --primary:#00ff99;--accent:#00ffff;
      --neon:0 0 6px #0ff,0 0 12px #0ff;
    }
    /* ===== latar gradient animasi ===== */
    body,html{
      margin:0;padding:0;font-family:'Segoe UI',sans-serif;color:var(--text);
      background:linear-gradient(-45deg,#8e2de2,#4a00e0,#ff6ec4,#8e2de2);
      background-size:600% 600%;animation:grad 15s ease infinite;
      scroll-behavior:smooth;
    }
    @keyframes grad{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}

    /* ===== header parallax ===== */
    .parallax{background:url('https://images.unsplash.com/photo-1529921879218-dc2c89f6f10f?auto=format&fit=crop&w=1350&q=80') center/cover fixed;
      min-height:250px;display:flex;align-items:center;justify-content:center}
    .parallax h1{background:rgba(0,0,0,.6);padding:1rem 1.5rem;border-radius:12px;font-size:1.8rem;
      text-shadow:var(--neon);animation:glow 2s ease alternate infinite,fadeUp .8s}
    @keyframes glow{from{text-shadow:0 0 4px #0ff}to{text-shadow:var(--neon)}}
    @keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1}}

    /* ===== layout & input ===== */
    .content{max-width:600px;margin:auto;padding:2rem}
    label{margin-top:.8rem}
    input,select{width:100%;padding:10px;border-radius:8px;background:rgba(0,0,0,.35);
      border:1px solid #888;color:#fff;font-size:1rem}
    input::placeholder{color:#ccc}
    input:focus{outline:none;border-color:#66ffe0;box-shadow:0 0 8px #66ffe0}
    .btn-neon{width:100%;padding:12px;margin-top:1rem;font-weight:bold;border:none;border-radius:32px;
      background:linear-gradient(90deg,#00ff99,#00ffff);color:#000;box-shadow:0 0 12px #0ff;transition:.3s}
    .btn-neon:hover{transform:scale(1.05);box-shadow:0 0 20px #0ff}

    /* ===== tabel ===== */
    table{width:100%;margin-top:1rem;border-collapse:collapse;background:rgba(0,0,0,.25)}
    th,td{padding:8px;border-bottom:1px solid var(--border)}
    th{background:rgba(0,0,0,.5)}
    .delete-btn{color:#ff4d4d;cursor:pointer;font-size:1.2rem;transition:.3s}
    .delete-btn:hover{transform:scale(1.25) rotate(-10deg);text-shadow:0 0 8px red}

    /* ===== modal hapus ===== */
    #deleteModal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;
      align-items:center;justify-content:center;z-index:1000}
    .modal-box{background:#1e1e2f;width:90%;max-width:320px;padding:1.5rem;
      border-radius:14px;text-align:center;box-shadow:0 0 15px #ff6ec4}
    .modal-btn{padding:.6rem 1.2rem;border:none;border-radius:8px;font-weight:bold;cursor:pointer;margin:.2rem}
    .modal-yes{background:#ff0066;color:#fff}.modal-no{background:#666;color:#fff}

    /* ===== notification ===== */
    #notify{position:fixed;top:20px;left:50%;transform:translateX(-50%);min-width:240px;max-width:90%;
      padding:12px 18px;border-radius:10px;font-weight:bold;text-align:center;z-index:1100;
      display:none;color:#000;box-shadow:0 0 12px #0ff;animation:fadeDown .4s}
    @keyframes fadeDown{from{opacity:0;transform:translate(-50%,-20px)}to{opacity:1;transform:translate(-50%,0)}}
    #notify.success{background:linear-gradient(90deg,#00ff99,#00ffff)}
    #notify.error{background:#ff4d4d;color:#fff;box-shadow:0 0 12px red}
    #notify .close{margin-left:12px;font-weight:bold;cursor:pointer}
  </style>
</head>
<body>
  <div class="parallax"><h1 class="sr-header">Pengantaran Andaria</h1></div>

  <!-- pop-up notifikasi -->
  <div id="notify"><span id="notify-text"></span><span class="close">&times;</span></div>

  <div class="content">
    <form id="form">
      <label>Nama Supir</label><input id="driver" placeholder="Contoh: Budi">
      <label>Plat Mobil</label><input id="plate" placeholder="KB 1234 XY">
      <label>Rute</label><input id="route" placeholder="Pontianak ‚Üí Sambas">
      <label>Tanggal</label><input id="date" type="date">
      <button type="submit" class="btn-neon">+ Simpan Pengantaran</button>
    </form>

    <input id="search" class="mt-3" placeholder="üîç Cari nama supir atau tanggal...">

    <table>
      <thead><tr><th>Supir</th><th>Plat</th><th>Rute</th><th>Tanggal</th><th>‚úîÔ∏è</th><th>üóëÔ∏è</th></tr></thead>
      <tbody id="data-body"></tbody>
    </table>
  </div>

  <!-- modal hapus -->
  <div id="deleteModal">
    <div class="modal-box">
      <p>Yakin ingin menghapus pengantaran ini?</p>
      <button id="yesDelete" class="modal-btn modal-yes">Ya, Hapus</button>
      <button id="noDelete" class="modal-btn modal-no">Batal</button>
    </div>
  </div>

<script>
/* ===== Firebase init ===== */
const firebaseConfig={apiKey:"AIzaSyCvyxjv9odhKVtL6u3Jjls70Jhui-yxGSo",
  authDomain:"pengantaran-andaria.firebaseapp.com",projectId:"pengantaran-andaria",
  storageBucket:"pengantaran-andaria.appspot.com",messagingSenderId:"501077706231",
  appId:"1:501077706231:web:51c1b456fe3c1d18e11af2"};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const deliveries=db.collection("pengantaran");
const drivers=db.collection("drivers");

/* ===== helper tanggal ===== */
const today=new Date().toISOString().split("T")[0];
date.value=today;

/* ===== notifikasi ===== */
function showNotif(msg,type="success"){
  const n=document.getElementById("notify");
  document.getElementById("notify-text").textContent=msg;
  n.className=type;
  n.style.display="block";
}
document.querySelector("#notify .close").onclick=()=>notify.style.display="none";

/* ===== auto-fill plat ===== */
driver.addEventListener("blur",async e=>{
  const name=e.target.value.trim().toLowerCase();
  if(!name) return;
  const snap=await drivers.doc(name).get();
  if(snap.exists) plate.value=snap.data().plat;
});

/* ===== submit form ===== */
form.addEventListener("submit",async e=>{
  e.preventDefault();
  const nama=driver.value.trim(),plat=plate.value.trim(),
        rute=route.value.trim(),tanggal=date.value;
  if(!nama||!plat||!rute||!tanggal){showNotif("Lengkapi semua data!","error");return;}
  try{
    await deliveries.add({nama,plat,rute,tanggal,dicek:false,dibuat:new Date()});
    await drivers.doc(nama.toLowerCase()).set({plat});
    form.reset();date.value=today;
    showNotif("Data berhasil disimpan!","success");
  }catch(err){
    console.error(err);showNotif("Gagal menyimpan data!","error");
  }
});

/* ===== render tabel harian ===== */
function rowHtml(id,d){
  return `<tr>
    <td>${d.nama}</td><td>${d.plat}</td><td>${d.rute}</td><td>${d.tanggal}</td>
    <td style="text-align:center"><input type="checkbox" ${d.dicek?'checked':''} data-id="${id}" class="chk"></td>
    <td style="text-align:center"><i class="fas fa-trash delete-btn" data-id="${id}"></i></td>
  </tr>`;
}
function loadDaily(){
  deliveries.where("tanggal","==",today).onSnapshot(snap=>{
    data-body.innerHTML="";
    const arr=[];snap.forEach(doc=>arr.push(doc));
    arr.sort((a,b)=>b.data().dibuat.seconds-a.data().dibuat.seconds);
    arr.forEach(doc=>data-body.insertAdjacentHTML("beforeend",rowHtml(doc.id,doc.data())));
  });
}
loadDaily();

/* ===== search global ===== */
search.addEventListener("input",async e=>{
  const q=e.target.value.toLowerCase();
  data-body.innerHTML="";
  (await deliveries.get()).forEach(doc=>{
    const d=doc.data();
    if(d.nama.toLowerCase().includes(q)||d.tanggal.includes(q))
      data-body.insertAdjacentHTML("beforeend",rowHtml(doc.id,d));
  });
});

/* ===== checkbox & hapus ===== */
document.addEventListener("change",e=>{
  if(e.target.classList.contains("chk"))
    deliveries.doc(e.target.dataset.id).update({dicek:e.target.checked});
});
let deleteId=null;
document.addEventListener("click",e=>{
  if(e.target.classList.contains("delete-btn")){deleteId=e.target.dataset.id;deleteModal.style.display="flex";}
});
yesDelete.onclick=async ()=>{if(deleteId) await deliveries.doc(deleteId).delete();closeModal();};
noDelete.onclick=closeModal;
function closeModal(){deleteId=null;deleteModal.style.display="none";}

/* ===== animasi ScrollReveal ===== */
ScrollReveal().reveal('.sr-header',{delay:200,distance:'40px',origin:'top',duration:1000});
ScrollReveal().reveal('.content',{delay:300,distance:'40px',origin:'bottom',duration:1200});
</script>
</body>
</html>
